on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  coverage:
    runs-on: macos-12

    steps:
    - uses: actions/checkout@v2

    - name: Xcode Select
      uses: devbotsxyz/xcode-select@v1.1.0
      with:
        version: 14.2

    - name: Test
      env:
        XCODE_VERSION: ${{ matrix.xcode_version }}
      shell: bash
      run: |
        ./prepareTestResults.sh
        swift test --enable-code-coverage

    - uses: codecov/codecov-action@v3
      with:
        files: .build/x86_64-apple-macosx/debug/codecov/XCTestHTMLReport.json
        fail_ci_if_error: true
        verbose: true
